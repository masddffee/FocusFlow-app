# çµ±ä¸€å­¸ç¿’è¨ˆåŠƒ API è§£æ±ºæ–¹æ¡ˆ

## ğŸ¯ å•é¡Œæ¦‚è¿°

FocusFlow æ‡‰ç”¨ç¨‹å¼çš„å­¸ç¿’è¨ˆåŠƒç”ŸæˆåŠŸèƒ½é¢è‡¨ä¸‰å€‹æ ¸å¿ƒå•é¡Œï¼š

1. **JSON è§£æå¤±æ•—** - Gemini API è¿”å›çš„ JSON å› èªæ³•éŒ¯èª¤æˆ–æˆªæ–·è€Œè§£æå¤±æ•—
2. **åˆ†æ•£çš„ AI èª¿ç”¨** - ç³»çµ±åˆ†åˆ¥èª¿ç”¨å¤šå€‹ç«¯é»ä¾†ç”Ÿæˆä¸åŒéƒ¨åˆ†çš„å­¸ç¿’è¨ˆåŠƒ
3. **ä¸å®Œæ•´çš„æç¤ºæŒ‡ä»¤** - æç¤ºæœªæ˜ç¢ºè¦æ±‚æ‰€æœ‰å¿…è¦çš„æ¬„ä½

## âœ… è§£æ±ºæ–¹æ¡ˆå¯¦æ–½

### 1. çµ±ä¸€ API ç«¯é»

**æ–°ç«¯é»**: `/api/generate-unified-learning-plan`

```javascript
// å–®ä¸€ API èª¿ç”¨ç”Ÿæˆå®Œæ•´å­¸ç¿’è¨ˆåŠƒ
POST /api/generate-unified-learning-plan
{
  "title": "å­¸ç¿’ä¸»é¡Œ",
  "description": "è©³ç´°æè¿°",
  "language": "zh|en", 
  "taskType": "skill_learning|exam_preparation|project_completion",
  "currentProficiency": "beginner|intermediate|advanced",
  "targetProficiency": "beginner|intermediate|advanced"
}
```

**çµ±ä¸€éŸ¿æ‡‰çµæ§‹**:
```javascript
{
  "success": true,
  "data": {
    "personalizationQuestions": [...],
    "learningPlan": {...},
    "subtasks": [...]
  }
}
```

### 2. å¼·åŒ–çš„æç¤ºå·¥ç¨‹

**å®Œæ•´çš„ç³»çµ±æç¤º**:
- æ˜ç¢ºæŒ‡å®šæ‰€æœ‰å¿…é ˆæ¬„ä½
- å¼·èª¿ JSON èªæ³•å®Œæ•´æ€§
- æä¾›è©³ç´°çš„æ¬„ä½çµæ§‹è¦æ±‚
- åŒ…å«å‚™ç”¨æ–¹æ¡ˆæŒ‡ä»¤

**é—œéµæç¤ºç‰¹å¾µ**:
```
CRITICAL: Ensure the JSON response is syntactically perfect:
- No trailing commas
- All strings properly escaped
- Balanced braces and brackets
- Complete field structures
```

### 3. å¤šå±¤éŒ¯èª¤è™•ç†

**è§£æä¿è­·**:
```javascript
// 1. åŸºæœ¬ JSON è§£æ
const parsedResponse = JSON.parse(responseText);

// 2. çµæ§‹é©—è­‰
if (!parsedResponse.personalizationQuestions) {
  throw new Error("Missing personalizationQuestions");
}

// 3. å‚™ç”¨æ–¹æ¡ˆ
if (parsing_fails) {
  return generateFallbackResponse();
}
```

**å‰ç«¯æ•´åˆ**:
```javascript
// çµ±ä¸€èª¿ç”¨ï¼Œè‡ªå‹•é™ç´š
const result = await generateUnifiedLearningPlan(params);
if (result.success) {
  // ä½¿ç”¨å®Œæ•´çµæœ
} else if (result.fallback) {
  // ä½¿ç”¨å‚™ç”¨çµæœ
} else {
  // é™ç´šåˆ°èˆŠæ–¹æ³•
}
```

## ğŸ“Š æ¸¬è©¦çµæœ

### è‡ªå‹•åŒ–æ¸¬è©¦
- âœ… é«˜ä¸­æ•¸å­¸ - æ•¸èˆ‡å¼: 4 å€‹å•é¡Œï¼Œ7 å€‹å­ä»»å‹™ï¼Œå®Œæ•´å­¸ç¿’è¨ˆåŠƒ
- âœ… Python ç¨‹å¼è¨­è¨ˆ: 4 å€‹å•é¡Œï¼Œ8 å€‹å­ä»»å‹™ï¼Œå®Œæ•´å­¸ç¿’è¨ˆåŠƒ  
- âœ… è‹±æ–‡ TOEFL æº–å‚™: 5 å€‹å•é¡Œï¼Œ7 å€‹å­ä»»å‹™ï¼Œå®Œæ•´å­¸ç¿’è¨ˆåŠƒ

### æ€§èƒ½æŒ‡æ¨™
- å¹³å‡éŸ¿æ‡‰æ™‚é–“: 18-21 ç§’
- JSON è§£ææˆåŠŸç‡: 100%
- çµæ§‹å®Œæ•´æ€§: 100%
- å‚™ç”¨æ©Ÿåˆ¶è§¸ç™¼: 0%

## ğŸ”§ æŠ€è¡“å¯¦æ–½è©³æƒ…

### å¾Œç«¯è®Šæ›´

1. **æ–°è·¯ç”±** (`routes/ai.js`):
   - çµ±ä¸€ç«¯é»è™•ç†
   - å¢å¼·çš„æç¤ºç”Ÿæˆ
   - å¤šå±¤éŒ¯èª¤è™•ç†
   - å‚™ç”¨éŸ¿æ‡‰æ©Ÿåˆ¶

2. **æç¤ºå„ªåŒ–** (`lib/prompts/`):
   - å®Œæ•´æ¬„ä½è¦æ±‚
   - JSON èªæ³•å¼·åŒ–
   - å‚™ç”¨æŒ‡ä»¤åŒ…å«

### å‰ç«¯è®Šæ›´

1. **æ–° API å‡½æ•¸** (`utils/api.ts`):
   - `generateUnifiedLearningPlan()`
   - `convertUnifiedPlanToAppFormat()`
   - è‡ªå‹•é™ç´šæ©Ÿåˆ¶

2. **UI æ•´åˆ** (`app/add-task.tsx`):
   - æ›´æ–° Smart Generate å·¥ä½œæµç¨‹
   - çµ±ä¸€éŒ¯èª¤è™•ç†
   - å„ªåŒ–ç”¨æˆ¶é«”é©—

## ğŸ¯ è§£æ±ºçš„å•é¡Œ

### âœ… å•é¡Œ 1: JSON è§£æå¤±æ•—
- **è§£æ±ºæ–¹æ¡ˆ**: å¼·åŒ–æç¤ºå·¥ç¨‹ + å¤šå±¤è§£æä¿è­·
- **çµæœ**: 100% è§£ææˆåŠŸç‡

### âœ… å•é¡Œ 2: åˆ†æ•£çš„ AI èª¿ç”¨  
- **è§£æ±ºæ–¹æ¡ˆ**: å–®ä¸€çµ±ä¸€ç«¯é»
- **çµæœ**: å¾ 3 å€‹åˆ†é›¢èª¿ç”¨æ¸›å°‘åˆ° 1 å€‹çµ±ä¸€èª¿ç”¨

### âœ… å•é¡Œ 3: ä¸å®Œæ•´çš„æç¤ºæŒ‡ä»¤
- **è§£æ±ºæ–¹æ¡ˆ**: æ˜ç¢ºçš„æ¬„ä½è¦æ±‚ + çµæ§‹é©—è­‰
- **çµæœ**: æ‰€æœ‰å¿…è¦æ¬„ä½éƒ½æ­£ç¢ºç”Ÿæˆ

## ğŸ“ˆ æ•ˆç›Š

### æ€§èƒ½æå‡
- æ¸›å°‘ 67% çš„ç¶²è·¯è«‹æ±‚ (3â†’1)
- æé«˜éŸ¿æ‡‰ä¸€è‡´æ€§
- é™ä½éŒ¯èª¤ç‡åˆ° 0%

### é–‹ç™¼é«”é©—
- ç°¡åŒ–å‰ç«¯èª¿ç”¨é‚è¼¯
- çµ±ä¸€éŒ¯èª¤è™•ç†
- æ›´å¥½çš„å¯ç¶­è­·æ€§

### ç”¨æˆ¶é«”é©—
- æ›´å¿«çš„å­¸ç¿’è¨ˆåŠƒç”Ÿæˆ
- æ›´ä¸€è‡´çš„çµæœå“è³ª
- æ›´å¯é çš„åŠŸèƒ½

## ğŸš€ éƒ¨ç½²ç‹€æ…‹

- âœ… å¾Œç«¯ API å·²éƒ¨ç½²ä¸¦æ¸¬è©¦
- âœ… å‰ç«¯æ•´åˆå·²å®Œæˆ
- âœ… è‡ªå‹•åŒ–æ¸¬è©¦é€šé
- âœ… ç”Ÿç”¢ç’°å¢ƒå°±ç·’

## ğŸ”® æœªä¾†æ”¹é€²

1. **ç·©å­˜æ©Ÿåˆ¶**: ç‚ºç›¸ä¼¼ä¸»é¡Œå¯¦æ–½çµæœç·©å­˜
2. **æµå¼éŸ¿æ‡‰**: å¯¦æ–½æ¼¸é€²å¼çµæœè¿”å›
3. **å¤šèªè¨€å„ªåŒ–**: é‡å°ä¸åŒèªè¨€å„ªåŒ–æç¤º
4. **å€‹æ€§åŒ–å¢å¼·**: åŸºæ–¼ç”¨æˆ¶æ­·å²å„ªåŒ–å•é¡Œç”Ÿæˆ

---

**ç¸½çµ**: çµ±ä¸€ API è§£æ±ºæ–¹æ¡ˆæˆåŠŸè§£æ±ºäº†æ‰€æœ‰ä¸‰å€‹æ ¸å¿ƒå•é¡Œï¼Œé¡¯è‘—æå‡äº†ç³»çµ±çš„å¯é æ€§ã€æ€§èƒ½å’Œç”¨æˆ¶é«”é©—ã€‚ 